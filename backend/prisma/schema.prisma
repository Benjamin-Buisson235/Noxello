generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum BoardRole {
  MEMBER
}

model User {
  id           Int      @id @default(autoincrement())
  email        String   @unique
  passwordHash String
  name         String?
  createdAt    DateTime @default(now())

  boards       Board[]
  boardMemberships BoardMember[]
  invitesSent BoardInvite[] @relation("InvitesSent")
  invitesReceived BoardInvite[] @relation("InvitesReceived")
  comments     Comment[]
}

model Board {
  id        Int      @id @default(autoincrement())
  title     String
  createdAt DateTime @default(now())

  ownerId Int
  owner   User   @relation(fields: [ownerId], references: [id])

  lists   List[]
  labels  Label[]
  members BoardMember[]
  invites BoardInvite[]
}

model BoardMember {
  boardId   Int
  userId    Int
  role      BoardRole @default(MEMBER)
  createdAt DateTime  @default(now())

  board Board @relation(fields: [boardId], references: [id], onDelete: Cascade)
  user  User  @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([boardId, userId])
}

model BoardInvite {
  id         Int      @id @default(autoincrement())
  boardId    Int
  inviterId  Int
  inviteeId  Int
  createdAt  DateTime @default(now())

  board   Board @relation(fields: [boardId], references: [id], onDelete: Cascade)
  inviter User  @relation("InvitesSent", fields: [inviterId], references: [id], onDelete: Cascade)
  invitee User  @relation("InvitesReceived", fields: [inviteeId], references: [id], onDelete: Cascade)

  @@unique([boardId, inviteeId])
}

model List {
  id        Int      @id @default(autoincrement())
  title     String
  position  Int
  createdAt DateTime @default(now())

  boardId Int
  board   Board @relation(fields: [boardId], references: [id])

  cards     Card[]
}

model Card {
  id        Int      @id @default(autoincrement())
  title     String
  description String?
  position  Int
  dueDate   DateTime?
  archived  Boolean  @default(false)
  archivedAt DateTime?

  list      List     @relation(fields: [listId], references: [id], onDelete: Cascade)
  listId    Int

  cardLabels CardLabel[]
  checklistItems ChecklistItem[]
  comments  Comment[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ChecklistItem {
  id        Int      @id @default(autoincrement())
  cardId    Int
  text      String
  done      Boolean  @default(false)
  position  Int      @default(0)
  createdAt DateTime @default(now())

  card      Card     @relation(fields: [cardId], references: [id], onDelete: Cascade)
}

model Comment {
  id        Int      @id @default(autoincrement())
  cardId    Int
  authorId  Int
  content   String
  createdAt DateTime @default(now())

  card    Card @relation(fields: [cardId], references: [id], onDelete: Cascade)
  author  User @relation(fields: [authorId], references: [id])
}

model Label {
  id      Int     @id @default(autoincrement())
  name    String
  color   String?
  boardId Int

  board      Board       @relation(fields: [boardId], references: [id])
  cardLabels CardLabel[]
}

model CardLabel {
  cardId  Int
  labelId Int

  card  Card  @relation(fields: [cardId], references: [id], onDelete: Cascade)
  label Label @relation(fields: [labelId], references: [id], onDelete: Cascade)

  @@id([cardId, labelId])
}
