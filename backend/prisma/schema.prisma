generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id           Int      @id @default(autoincrement())
  email        String   @unique
  passwordHash String
  name         String?
  createdAt    DateTime @default(now())

  boards       Board[]
  comments     Comment[]
}

model Board {
  id        Int      @id @default(autoincrement())
  title     String
  createdAt DateTime @default(now())

  ownerId Int
  owner   User   @relation(fields: [ownerId], references: [id])

  lists   List[]
  labels  Label[]
}

model List {
  id        Int      @id @default(autoincrement())
  title     String
  position  Int
  createdAt DateTime @default(now())

  boardId Int
  board   Board @relation(fields: [boardId], references: [id])

  cards     Card[]
}

model Card {
  id        Int      @id @default(autoincrement())
  title     String
  description String?
  position  Int
  dueDate   DateTime?
  archived  Boolean  @default(false)
  archivedAt DateTime?

  list      List     @relation(fields: [listId], references: [id], onDelete: Cascade)
  listId    Int

  cardLabels CardLabel[]
  checklistItems ChecklistItem[]
  comments  Comment[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ChecklistItem {
  id        Int      @id @default(autoincrement())
  cardId    Int
  text      String
  done      Boolean  @default(false)
  position  Int      @default(0)
  createdAt DateTime @default(now())

  card      Card     @relation(fields: [cardId], references: [id], onDelete: Cascade)
}

model Comment {
  id        Int      @id @default(autoincrement())
  cardId    Int
  authorId  Int
  content   String
  createdAt DateTime @default(now())

  card    Card @relation(fields: [cardId], references: [id], onDelete: Cascade)
  author  User @relation(fields: [authorId], references: [id])
}

model Label {
  id      Int     @id @default(autoincrement())
  name    String
  color   String?
  boardId Int

  board      Board       @relation(fields: [boardId], references: [id])
  cardLabels CardLabel[]
}

model CardLabel {
  cardId  Int
  labelId Int

  card  Card  @relation(fields: [cardId], references: [id], onDelete: Cascade)
  label Label @relation(fields: [labelId], references: [id], onDelete: Cascade)

  @@id([cardId, labelId])
}
